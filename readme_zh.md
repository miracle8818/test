## 📋 目录

- [一、数据概述](#一数据概述)
  - [数据特点](#数据特点)
  - [支持的分辨率](#支持的分辨率)
- [二、价格存储机制](#二价格存储机制)
  - [Deci-Cents 格式](#deci-cents-格式)
  - [价格转换](#价格转换)
- [三、数据使用流程](#三数据使用流程)
  - [数据订阅与读取](#数据订阅与读取)
  - [数据聚合](#数据聚合)
  - [订单填充价格获取](#订单填充价格获取)
- [四、订单撮合机制](#四订单撮合机制)
  - [价格获取优先级](#价格获取优先级)
  - [订单类型与撮合](#订单类型与撮合)
  - [滑点计算](#滑点计算)
- [五、数据优先级与选择](#五数据优先级与选择)
- [六、数据缺失处理](#六数据缺失处理)
- [七、数据格式详解](#七数据格式详解)
- [八、附录](#八附录)

---

## 一、数据概述

### 数据特点

| 特性 | 说明 |
|------|------|
| **Tick数据** | 未过滤的原始交易记录，包含所有逐笔数据 |
| **Bar数据** | 已过滤可疑tick，并合并为K线数据 |
| **时区** | 美国股票数据采用纽约时区（EST/EDT） |
| **数据源** | 2007年前：QuantQuote（仅Trade数据）；2007年后：AlgoSeek（Trade和Quote数据） |

### 支持的分辨率

| 分辨率 | 说明 | 数据格式 | 可用性 |
|--------|------|---------|--------|
| **Tick** | 逐笔数据 | Trade Tick / Quote Tick | 完整 |
| **Second** | 秒级K线 | TradeBar / QuoteBar | 完整 |
| **Minute** | 分钟K线 | TradeBar / QuoteBar | 完整（系统默认） |
| **Hour** | 小时K线 | TradeBar（仅Trade） | 完整 |
| **Daily** | 日线K线 | TradeBar（仅Trade） | 完整 |

> **注意**：Hour 和 Daily 分辨率仅提供 TradeBar 数据，无 QuoteBar 数据。

---

## 二、价格存储机制

### Deci-Cents 格式

系统使用 **deci-cents（十分之一美分）** 格式存储价格，这是一种整数存储方式，可以避免浮点数精度问题。

### 价格转换
pandoc readme_zh.md \
  --pdf-engine=xelatex \
  -V mainfont="Noto Sans CJK SC" \
  -V geometry:margin=1in \
  --toc \
  --toc-depth=3 \
  -o readme_zh.pdf
**转换公式**：
```
实际价格（美元）= 数据文件中的值 ÷ 10,000
```

**转换示例**：

| 数据文件值 | 计算过程 | 实际价格 |
|-----------|---------|---------|
| 6448000 | 6448000 ÷ 10000 | $64.48 |
| 137450 | 137450 ÷ 10000 | $13.745 |
| 1000000 | 1000000 ÷ 10000 | $100.00 |

**系统处理流程**：
```
CSV文件读取
    ↓
解析为整数（deci-cents）
    ↓
应用缩放因子（1/10000 = 0.0001）
    ↓
转换为美元价格（decimal类型）
    ↓
用于算法计算和订单填充
```

> **重要提示**：
> - ✅ 系统会自动完成转换，算法中直接使用美元价格
> - ✅ 无需手动除以10000
> - ✅ 所有价格都是 `decimal` 类型，保证精度

---

## 三、数据使用流程

### 数据订阅与读取

**订阅流程**：
```
AddEquity("AAPL", Resolution.Minute)
    ↓
创建订阅配置
    ↓
确定数据文件路径
    ↓
查找并读取数据文件
```

**读取流程**：
```
数据文件查找
    ↓
文件存在？
    ├─ 是 → 读取ZIP文件
    │       ↓
    │   解压CSV文件
    │       ↓
    │   逐行解析
    │       ↓
    │   应用价格转换
    │       ↓
    │   创建TradeBar/QuoteBar对象
    │       ↓
    │   传递给算法
    │
    └─ 否 → 记录警告日志
            ↓
        尝试使用替代数据
            ↓
        或跳过该时间点
```

### 数据聚合

当使用 Tick 数据时，系统会自动聚合成 Bar：

```
多个Trade Tick
    ↓
TickConsolidator
    ↓
聚合为TradeBar
    ├─ Open: 第一个tick的价格
    ├─ High: 所有tick的最高价
    ├─ Low: 所有tick的最低价
    ├─ Close: 最后一个tick的价格
    └─ Volume: 所有tick的成交量总和
```

### 订单填充价格获取

系统在填充订单时，会根据**订单方向**和**可用数据类型**，按优先级获取最合适的填充价格。

**核心原则**：
- **买入订单**：使用 Ask Price（卖一价），因为买入时需要支付卖方的报价
- **卖出订单**：使用 Bid Price（买一价），因为卖出时获得买方的报价

---

## 四、订单撮合机制

### 价格获取优先级

系统采用**智能价格获取策略**，按以下优先级尝试获取价格：

| 优先级 | 数据类型 | 买入订单使用 | 卖出订单使用 | 优势 | 劣势 |
|--------|---------|------------|------------|------|------|
| **1** | Quote Tick | AskPrice | BidPrice | 最精确，包含实时买卖价差 | 仅2007年后可用 |
| **2** | QuoteBar | Ask.Close（如果Ask为null则回退到QuoteBar.Close） | Bid.Close（如果Bid为null则回退到QuoteBar.Close） | 有买卖价差，精度较高 | 精度略低于Tick |
| **3** | Trade Tick | Price | Price | 精确的成交价格 | 买卖价格相同，可能低估成本 |
| **4** | TradeBar | Close | Close | 数据完整，历史覆盖广 | 买卖价格相同，精度较低 |
| **5** | 资产当前价格 | Security.Price | Security.Price | 最后已知价格 | 可能不准确 |

> **注意**：
> - 对于Tick类型，系统首先尝试使用Quote Tick的AskPrice/BidPrice，如果不可用（为0），会回退到Trade Tick的Price
> - 对于QuoteBar，如果Ask或Bid为null，会回退到QuoteBar.Close（该值可能是Bid和Ask的平均值，或单独使用Bid/Ask的值）

**价格获取流程图**：
```
Quote Tick（最精确）
    ↓ 如果不可用
QuoteBar（包含买卖价差）
    ↓ 如果不可用
Trade Tick（成交价格）
    ↓ 如果不可用
TradeBar（K线收盘价）
    ↓ 如果都不可用
资产当前价格（Last Price）
```

### 实际示例对比

#### 场景 A：有 Quote 数据（理想情况）

```
当前市场数据：
- Bid Price（买一价）：$64.48
- Ask Price（卖一价）：$64.50
- 买卖价差：$0.02

买入 100 股：
→ 使用 Ask Price: $64.50
→ 总成本：$6,450
→ 交易成本：$2（价差）

卖出 100 股：
→ 使用 Bid Price: $64.48
→ 总收入：$6,448
→ 交易成本：$2（价差）
```

#### 场景 B：只有 Trade 数据（常见情况）

```
当前市场数据：
- Trade Price（成交价）：$64.49
- 无 Quote 数据

买入 100 股：
→ 使用 Trade Price: $64.49
→ 总成本：$6,449
→ 交易成本：$0（假设，实际可能有价差）

卖出 100 股：
→ 使用 Trade Price: $64.49
→ 总收入：$6,449
→ 交易成本：$0（假设，实际可能有价差）

⚠️ 注意：这种情况下可能低估了实际交易成本
```

### 订单类型与撮合

#### 1. 市价单（Market Order）

**特点**：立即以当前市场价格成交

**撮合流程**：
```
算法提交市价单
    ↓
检查交易所是否开盘
    ↓
获取当前最佳价格（按优先级）
    ↓
计算滑点（考虑订单大小）
    ↓
计算最终填充价格
    ↓
检查资金/持仓是否充足
    ↓
生成订单填充事件
```

**价格计算**：
- **买入市价单**：`最终价格 = Ask Price + 滑点`
- **卖出市价单**：`最终价格 = Bid Price - 滑点`

#### 2. 限价单（Limit Order）

**特点**：只在指定价格或更优价格成交

**撮合流程**：
```
算法提交限价单
    ↓
检查交易所是否开盘
    ↓
获取当前市场价格
    ↓
检查价格是否满足条件
    ├─ 买入限价单：当前价格 ≤ 限价
    └─ 卖出限价单：当前价格 ≥ 限价
    ↓
如果满足 → 以限价或更优价格成交
如果不满足 → 等待或取消
```

#### 3. 止损单（Stop Order）

**特点**：价格触发后转为市价单

**撮合流程**：
```
算法提交止损单
    ↓
监控市场价格
    ↓
检查是否触发止损价格
    ├─ 买入止损：价格 ≥ 止损价
    └─ 卖出止损：价格 ≤ 止损价
    ↓
如果触发 → 转为市价单执行
如果不触发 → 继续等待
```

### 滑点计算

#### 什么是滑点？

滑点是指**预期价格与实际成交价格的差异**，通常由以下因素造成：
- 市场流动性不足
- 大额订单的市场冲击
- 订单执行延迟

**滑点的影响**：
```
最终填充价格 = 理论价格 ± 滑点
```

滑点大小取决于：
- **订单数量**：数量越大，滑点越大
- **市场流动性**：流动性越好，滑点越小
- **滑点模型类型**：不同的模型有不同的计算方式

#### 滑点模型类型

| 模型类型 | 说明 | 适用场景 | 大额订单处理 |
|---------|------|---------|-------------|
| **无滑点** | 不应用滑点 | 理想化回测 | ❌ 不现实 |
| **固定百分比滑点** | 按价格百分比计算 | 通用场景 | ⚠️ 中等适用 |
| **成交量比例滑点** | 根据订单/成交量比例 | 大额订单 | ✅ 较准确 |
| **市场冲击模型** | 考虑市场深度和冲击 | 超大额订单 | ✅✅ 最准确 |

#### 滑点模型详解

##### 1. 无滑点模型（NullSlippageModel）

**默认模型**：系统默认使用此模型（除非显式设置其他模型）

**计算公式**：`滑点 = 0`

**使用场景**：
- 理想化回测
- 不考虑交易成本的策略测试

##### 2. 固定百分比滑点模型（ConstantSlippageModel）

**计算公式**：`滑点 = 当前价格 × 滑点百分比`

**参数**：
- `slippagePercent`：滑点百分比（0 到 1 之间，例如 0.001 表示 0.1%）

**示例**：
```
当前价格：$64.50
滑点百分比：0.001（0.1%）
滑点 = $64.50 × 0.001 = $0.0645
```

**适用场景**：
- 小额订单
- 流动性好的市场
- 简单的策略回测

##### 3. 成交量比例滑点模型（VolumeShareSlippageModel）

**计算公式**：
```
成交量占比 = min(订单数量 / 当前Bar成交量, volumeLimit)
滑点百分比 = 成交量占比² × priceImpact
滑点 = 当前价格 × 滑点百分比
```

**参数**：
- `volumeLimit`：最大成交量占比限制（默认 0.025，即 2.5%）
- `priceImpact`：价格冲击系数（默认 0.1，即 10%）

**关键特点**：
- 使用**平方关系**：滑点与成交量占比的平方成正比，反映大额订单的非线性影响
- 自动限制：成交量占比不会超过 volumeLimit，避免极端情况
- 数据源适配：根据数据类型选择不同的成交量字段
  - TradeBar：使用 `Volume` 字段
  - QuoteBar：买入订单使用 `LastBidSize`，卖出订单使用 `LastAskSize`
- 如果成交量为0或负数，会使用最大滑点百分比（volumeLimit² × priceImpact）

**示例**：
```
当前价格：$64.50
当前Bar成交量：10,000 股
订单数量：1,000 股
volumeLimit：0.025（2.5%）
priceImpact：0.1（10%）

计算过程：
1. 成交量占比 = min(1000 / 10000, 0.025) = 0.025
2. 滑点百分比 = 0.025² × 0.1 = 0.00000625
3. 滑点 = $64.50 × 0.00000625 = $0.0004
```

**适用场景**：
- 大额订单
- 需要考虑市场流动性的策略
- 更真实的回测场景

##### 4. 市场冲击滑点模型（MarketImpactSlippageModel）

**最复杂的滑点模型**，基于 Almgren-Chriss 市场冲击理论，考虑永久冲击和临时冲击。

**计算公式**：
```
归一化成交量 = 订单数量 / 执行时间 / 平均成交量
永久冲击 = σ × 执行时间 × G(归一化成交量) × 流动性调整 + 随机噪声
临时冲击 = σ × H(归一化成交量) + 随机噪声
实际冲击 = 临时冲击 + 永久冲击 × 0.5
滑点 = 当前价格 × 实际冲击百分比
```

**辅助函数**：
- 永久冲击函数：`G(nu) = gamma × nu^alpha`
- 临时冲击函数：`H(nu) = eta × nu^beta`

**参数**：
| 参数 | 说明 | 默认值 |
|------|------|--------|
| `latency` | 订单提交到成交的延迟时间 | 0.075 秒 |
| `impactTime` | 市场冲击持续时间 | 1800 秒（30分钟） |
| `alpha` | 永久冲击指数 | 0.891 |
| `beta` | 临时冲击指数 | 0.600 |
| `gamma` | 永久冲击系数 | 0.314 |
| `eta` | 临时冲击系数 | 0.142 |
| `delta` | 流动性调整指数 | 0.267 |

**关键特点**：
- **动态计算**：基于历史数据计算波动率（σ）和平均成交量
- **随机性**：加入高斯随机噪声，模拟市场不确定性
- **流动性调整**：考虑流通股数量，大市值股票流动性更好
- **时间因素**：考虑执行时间和冲击持续时间
- **非线性关系**：使用指数函数，反映大额订单的复杂影响

**数据需求**：
- 需要至少 252 个交易日的历史数据来计算波动率
- 需要日线成交量数据
- 可选：基本面数据（流通股数量）

**适用场景**：
- 超大额订单（占成交量比例很大）
- 需要最真实市场冲击模拟的策略
- 机构级策略回测

**注意事项**：
- 默认参数基于约 20 年前的数据校准，可能需要重新校准
- 计算复杂度较高，可能影响回测速度
- 需要足够的历史数据才能正常工作

#### 滑点在订单填充中的应用

**应用流程**：
1. 获取基础价格：根据订单方向获取 Ask Price（买入）或 Bid Price（卖出）
2. 计算滑点：调用滑点模型计算滑点金额
3. 应用滑点：
   - 买入订单：`最终价格 = 基础价格 + 滑点`（价格上升，成本增加）
   - 卖出订单：`最终价格 = 基础价格 - 滑点`（价格下降，收入减少）

> **重要提示**：
> - 滑点**总是对交易者不利**
> - 滑点模型返回的是**绝对金额**（美元），不是百分比
> - 如果滑点模型返回 0，则无滑点（理想情况）

### 完整撮合流程示例

#### 示例 1：买入 100 股 AAPL（小额订单）

```
1. 算法提交订单：MarketOrder("AAPL", 100)
2. 系统检查交易所状态：交易所是否开盘？ → 是
3. 获取市场价格：
   - 可用数据类型：QuoteBar（优先）或 TradeBar（备选）
4. 确定基础价格：
   - 订单方向：买入
   - 使用 Ask Price
   - 当前 Ask: $64.50
5. 计算滑点：
   - 订单数量：100 股（小额）
   - 滑点：$0.01（固定或百分比）
6. 计算最终价格：
   - 最终价格：$64.50 + $0.01 = $64.51
7. 检查资金充足性：
   - 所需资金：$6,451
   - 可用资金：$10,000
   - 资金充足
8. 生成订单事件：
   - Status: Filled
   - FillPrice: $64.51
   - FillQuantity: 100
9. 更新持仓：
   - 持仓数量：+100
   - 平均成本：$64.51
```

#### 示例 2：买入 10,000 股 AAPL（大额订单）

```
1. 算法提交订单：MarketOrder("AAPL", 10000)
2. 系统检查交易所状态：交易所是否开盘？ → 是
3. 获取市场价格：
   - 可用数据类型：QuoteBar（优先，包含买卖价差）
4. 确定基础价格：
   - 订单方向：买入
   - 使用 Ask Price
   - 当前 Ask: $64.50
5. 评估订单规模：
   - 订单数量：10,000 股
   - 平均成交量：10,000 股/分钟
   - 订单占比：100%（非常大）
6. 计算滑点（考虑市场冲击）：
   - 基础滑点：$0.065（0.1%）
   - 市场冲击：$0.15（因为订单占成交量100%）
   - 总滑点：$0.215
7. 计算最终价格：
   - 最终价格：$64.50 + $0.215 = $64.715
8. 检查资金充足性：
   - 所需资金：$647,150
   - 可用资金：$1,000,000
   - 资金充足
9. 生成订单事件：
   - Status: Filled
   - FillPrice: $64.715
   - FillQuantity: 10000
   - Message: "Filled with market impact"
10. 更新持仓：
    - 持仓数量：+10,000
    - 平均成本：$64.715
    - 额外成本：$2,150（相比理论价格）
```

### 订单撮合时间点

| 订单类型 | 执行时间 | 说明 |
|---------|---------|------|
| **市价单** | 订单提交的**下一个数据点** | 需要看到市场数据才能确定价格 |
| **限价单/止损单** | 价格条件满足的**数据点** | 系统在每个数据点检查条件 |

### 数据新鲜度检查

系统会检查数据的**新鲜度**（Staleness），避免使用过时的价格：

```
数据时间 ≥ 订单时间 - 过期阈值
```

如果数据过时：
- 系统会尝试使用更早的数据（Best Effort）
- 记录警告信息
- 可能影响填充价格的准确性

### 最佳实践与注意事项

#### ✅ 最佳实践

1. **使用 Quote 数据**：如果有 Quote 数据，系统会使用更真实的买卖价差
2. **理解滑点影响**：滑点会显著影响高频策略和大额订单的收益
3. **注意数据分辨率**：高分辨率数据（Tick/Second）提供更精确的填充
4. **考虑市场时间**：订单只在交易所开盘时执行
5. **大额订单策略**：使用成交量相关的滑点模型，更准确地模拟市场冲击

#### ⚠️ 注意事项

1. **数据缺失**：如果只有 Trade 数据，买卖价格相同，可能高估收益
2. **时间延迟**：市价单在下一个数据点执行，不是立即执行
3. **价格假设**：系统假设市场流动性充足，超大额订单可能不现实
4. **滑点模型**：默认滑点可能不适合所有策略，需要根据实际情况调整
5. **大额订单警告**：超大额订单的市场冲击在回测中可能被低估，实际交易中影响更大

---

## 五、数据优先级与选择

### 数据重要性排序

#### 🥇 第一梯队：核心必需数据

1. **TradeBar - Daily（日线交易K线）** ⭐⭐⭐⭐⭐
   - **重要性**：最高
   - **使用场景**：长期持仓、基本面策略、回测
   - **数据量**：极小，存储成本低
   - **可用性**：历史数据最完整

2. **TradeBar - Minute（分钟交易K线）** ⭐⭐⭐⭐⭐
   - **重要性**：最高（系统默认分辨率）
   - **使用场景**：日内策略、技术指标计算、大多数量化策略
   - **数据量**：小，处理效率高
   - **可用性**：完整

3. **TradeBar - Hour（小时交易K线）** ⭐⭐⭐⭐
   - **重要性**：高
   - **使用场景**：多日持仓策略、中等频率交易
   - **数据量**：小
   - **可用性**：完整

#### 🥈 第二梯队：重要补充数据

4. **Trade Tick（逐笔交易数据）** ⭐⭐⭐⭐
   - **重要性**：中高
   - **使用场景**：高频策略、精确回测、微观结构分析
   - **数据量**：大
   - **可用性**：完整

5. **QuoteBar - Minute（分钟报价K线）** ⭐⭐⭐
   - **重要性**：中
   - **使用场景**：需要精确填充的策略、做市策略
   - **数据量**：小
   - **可用性**：仅2007年后

#### 🥉 第三梯队：可选增强数据

6. **TradeBar - Second（秒级交易K线）** ⭐⭐⭐
   - **重要性**：中低
   - **使用场景**：秒级策略、超短期交易
   - **数据量**：中
   - **可用性**：完整

7. **Quote Tick（逐笔报价数据）** ⭐⭐
   - **重要性**：中低
   - **使用场景**：高频做市、订单簿分析
   - **数据量**：极大
   - **可用性**：仅2007年后

### 数据选择建议

| 策略类型 | 推荐数据 | 说明 |
|---------|---------|------|
| **新手/学习** | TradeBar Daily + Minute | 最小数据集，足够学习 |
| **长期策略** | TradeBar Daily + Hour | 关注长期趋势 |
| **日内策略** | TradeBar Minute | 最常用配置 |
| **高频策略** | Trade Tick + Quote Tick | 需要最细粒度数据 |
| **精确回测** | Trade Tick + QuoteBar | 更真实的订单填充 |
| **大额订单策略** | QuoteBar + Quote Tick | 需要准确的买卖价差 |

---

## 六、数据缺失处理

### 自动回退机制

系统具有智能的数据回退机制，确保在数据缺失时仍能正常运行：

#### 1. 数据类型回退

```
QuoteBar/Quote Tick（如果可用）
    ↓ 如果缺失
TradeBar/Trade Tick
    ↓ 如果缺失
使用资产当前价格（Last Price）
```

#### 2. 分辨率回退

```
请求的分辨率（如Second）
    ↓ 如果缺失
较低分辨率（如Minute）
    ↓ 如果缺失
最低分辨率（如Daily）
```

#### 3. 缺失时的系统行为

| 缺失情况 | 系统行为 | 影响 |
|---------|---------|------|
| **缺少 Quote 数据** | 自动使用 Trade 数据 | ✅ 无影响，系统正常运行 |
| **缺少高分辨率数据** | 使用低分辨率数据或填充前值 | ⚠️ 可能影响精度 |
| **缺少必需数据** | 记录错误日志，跳过该时间点 | ❌ 可能导致策略无法执行 |
| **数据文件不存在** | 返回 null，记录警告日志 | ⚠️ 该时间点无数据 |

### 数据可用性说明

| 时期/分辨率 | 可用数据类型 | 说明 |
|------------|------------|------|
| **2007年前** | 只有 Trade 数据 | 无 Quote 数据 |
| **2007年后** | Trade 和 Quote 数据 | 同时提供两种数据类型 |
| **Hour/Daily 分辨率** | 只有 TradeBar 数据 | 无 QuoteBar |
| **Tick 数据** | 可聚合成任意分辨率的 Bar | 灵活使用 |

### 常见问题

**Q: 只有 Trade 数据能运行吗？**  
A: ✅ 可以！系统会自动使用 Trade 数据进行回测和交易。Quote 数据是可选的，主要用于更精确的订单填充。

**Q: 数据缺失会怎样？**  
A: 系统会：
1. 尝试使用替代数据（如 Trade 替代 Quote）
2. 使用较低分辨率的数据
3. 记录警告日志
4. 如果必需数据完全缺失，会跳过该时间点

---

## 七、数据格式详解

### 分钟、秒级数据文件格式

#### 文件位置

```
/data/equity/usa/{resolution}/ticker/{YYYYMMDD}_{trade|quote}.zip
```

**示例**：
- `/data/equity/usa/minute/aapl/20140605_trade.zip`
- `/data/equity/usa/minute/aapl/20140605_quote.zip`

> **注意**：只有2007年后的时期才有报价数据。

#### TradeBar CSV 格式

**文件内容**：`20140605_aapl_minute_trade.csv`

| 字段 | 说明 | 示例值 | 实际价格 |
|------|------|--------|---------|
| **Time** | 自午夜以来的毫秒数（纽约时区） | 15300000 | 15:30:00 |
| **Open** | 开盘价（deci-cents） | 6448000 | $64.48 |
| **High** | 最高价（deci-cents） | 6450000 | $64.50 |
| **Low** | 最低价（deci-cents） | 6445000 | $64.45 |
| **Close** | 收盘价（deci-cents） | 6449000 | $64.49 |
| **Volume** | 成交量（股数） | 90 | 90股 |

**CSV示例**：
```csv
Time,Open,High,Low,Close,Volume
15300000,6448000,6450000,6445000,6449000,90
```

#### QuoteBar CSV 格式

**文件内容**：`20140605_aapl_minute_quote.csv`

| 字段 | 说明 | 示例值 | 实际价格 |
|------|------|--------|---------|
| **Time** | 自午夜以来的毫秒数 | 15300000 | 15:30:00 |
| **Bid Open** | 买一开盘价（deci-cents） | 6448000 | $64.48 |
| **Bid High** | 买一最高价（deci-cents） | 6449000 | $64.49 |
| **Bid Low** | 买一最低价（deci-cents） | 6447000 | $64.47 |
| **Bid Close** | 买一收盘价（deci-cents） | 6448500 | $64.485 |
| **Bid Size** | 买一数量（股数） | 90 | 90股 |
| **Ask Open** | 卖一开盘价（deci-cents） | 6500000 | $65.00 |
| **Ask High** | 卖一最高价（deci-cents） | 6501000 | $65.01 |
| **Ask Low** | 卖一最低价（deci-cents） | 6499000 | $64.99 |
| **Ask Close** | 卖一收盘价（deci-cents） | 6500500 | $65.005 |
| **Ask Size** | 卖一数量（股数） | 100 | 100股 |

**CSV示例**：
```csv
Time,Bid Open,Bid High,Bid Low,Bid Close,Bid Size,Ask Open,Ask High,Ask Low,Ask Close,Ask Size
15300000,6448000,6449000,6447000,6448500,90,6500000,6501000,6499000,6500500,100
```

### 小时和日线文件格式

#### 文件位置

```
/data/equity/usa/{hour|daily}/ticker.zip
```

**示例**：
- `/data/equity/usa/hour/aapl.zip`
- `/data/equity/usa/daily/aapl.zip`

> **注意**：小时和日线分辨率仅提供交易K线数据（无Quote数据）。

#### CSV 格式

**文件内容**：`aapl.csv`

| 字段 | 说明 | 示例值 | 实际价格 |
|------|------|--------|---------|
| **DateTime** | 字符串日期 "YYYYMMDD HH:MM"（纽约时区） | 20131001 09:00 | 2013-10-01 09:00 |
| **Open** | 开盘价（deci-cents） | 6448000 | $64.48 |
| **High** | 最高价（deci-cents） | 6450000 | $64.50 |
| **Low** | 最低价（deci-cents） | 6445000 | $64.45 |
| **Close** | 收盘价（deci-cents） | 6449000 | $64.49 |
| **Volume** | 成交量（股数） | 90 | 90股 |

**CSV示例**：
```csv
DateTime,Open,High,Low,Close,Volume
20131001 09:00,6448000,6450000,6445000,6449000,90
```

### Tick文件格式

#### 文件位置

```
/data/equity/usa/tick/ticker/{YYYYMMDD}_{trade|quote}.zip
```

**示例**：
- `/data/equity/usa/tick/aapl/20131008_trade.zip`
- `/data/equity/usa/tick/aapl/20131008_quote.zip`

#### Trade Tick CSV 格式

**文件内容**：`20131008_aapl_Trade_Tick.csv`

| 字段 | 说明 | 示例值 | 实际价格 |
|------|------|--------|---------|
| **Time** | 自午夜以来的毫秒数（精确到小数点） | 14400009.367 | 14:40:00.009 |
| **TradeSale** | 成交价格（deci-cents） | 137450 | $13.745 |
| **Trade Volume** | 成交数量（股数） | 100 | 100股 |
| **Exchange** | 交易所代码 | D | FINRA |
| **Trade Sale Condition** | 交易条件代码 | 1 | 常规交易 |
| **Suspicious** | 是否可疑（0=否，1=是） | 0 | 正常 |

**CSV示例**：
```csv
Time,TradeSale,Trade Volume,Exchange,Trade Sale Condition,Suspicious
14400009.367,137450,100,D,1,0
```

> **重要说明**：
> - TradeBar数据会排除标记为可疑（Suspicious=1）的tick
> - 可疑tick通常表示交易价格远离其他市场价格，可能会被撤销

#### Quote Tick CSV 格式

**文件内容**：`20131008_aapl_Quote_Tick.csv`

| 字段 | 说明 | 示例值 | 实际价格 |
|------|------|--------|---------|
| **Time** | 自午夜以来的毫秒数 | 14400009.367 | 14:40:00.009 |
| **Bid Sale** | 买一价格（deci-cents） | 137450 | $13.745 |
| **Bid Size** | 买一数量（股数） | 100 | 100股 |
| **Ask Sale** | 卖一价格（deci-cents） | 137500 | $13.75 |
| **Ask Size** | 卖一数量（股数） | 200 | 200股 |
| **Exchange** | 交易所代码 | D | FINRA |
| **Quote Sale Condition** | 报价条件代码 | 1 | 正常交易环境 |
| **Suspicious** | 是否可疑（0=否，1=是） | 0 | 正常 |

**CSV示例**：
```csv
Time,Bid Sale,Bid Size,Ask Sale,Ask Size,Exchange,Quote Sale Condition,Suspicious
14400009.367,137450,100,137500,200,D,1,0
```

> **重要说明**：
> - 每个报价tick仅包含买一或卖一数据（不是同时包含）
> - QuoteBar数据会排除标记为可疑的tick

---

## 八、附录

### Tick交易所代码

| 交易所字母 | 交易所名称 |
|-----------|-----------|
| A | NYSE MKT 股票交易所 |
| B | NASDAQ OMX BX 股票交易所 |
| C | 国家股票交易所 |
| D | FINRA |
| I | 国际证券交易所 |
| J | Direct Edge A 股票交易所 |
| K | Direct Edge X 股票交易所 |
| M | 芝加哥股票交易所 |
| N | 纽约股票交易所 |
| T | NASDAQ OMX 股票交易所 |
| P | NYSE Arca SM |
| S | 统一报价系统 |
| T/Q | NASDAQ 股票交易所 |
| W | CBOE 股票交易所 |
| X | NASDAQ OMX PSX 股票交易所 |
| Y | BATS Y-交易所 |
| Z | BATS 交易所 |

### Tick交易条件

主要交易条件代码：

| 代码 | 说明 |
|------|------|
| 0 | 无条件 |
| 1 | 常规交易 |
| 2 | 同日清算交易 |
| 4 | 次日清算交易 |
| 400 | 延长交易时间 |
| 800 | Sold Last（延迟报告） |
| 1000000 | 官方收盘价 |
| 4000000 | 官方开盘价 |

---

## 💡 快速参考

### 价格转换速查

| 数据文件值 | 实际价格 |
|-----------|---------|
| 6448000 | $64.48 |
| 137450 | $13.745 |
| 1000000 | $100.00 |

### 数据文件路径速查

| 数据类型 | 路径格式 |
|---------|---------|
| 分钟Trade | `/data/equity/usa/minute/ticker/YYYYMMDD_trade.zip` |
| 分钟Quote | `/data/equity/usa/minute/ticker/YYYYMMDD_quote.zip` |
| 日线Trade | `/data/equity/usa/daily/ticker.zip` |
| Tick Trade | `/data/equity/usa/tick/ticker/YYYYMMDD_trade.zip` |
| Tick Quote | `/data/equity/usa/tick/ticker/YYYYMMDD_quote.zip` |

### 订单填充价格速查

| 订单规模 | 价格计算方式 |
|---------|-------------|
| 小额订单（< 1,000股） | 基础价格 + 固定滑点（$0.01） |
| 中等订单（1,000 - 10,000股） | 基础价格 + 百分比滑点（0.1%） |
| 大额订单（> 10,000股） | 基础价格 + 百分比滑点 + 市场冲击 |
